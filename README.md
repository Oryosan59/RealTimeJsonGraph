# RealTimeJsonGraph

このC#コードは、WPFアプリケーションでリアルタイムにJSONファイルを読み取り、3Dデータポイントを視覚化する仕組みを実装している。

---

### **全体概要**

#### **ライブラリと名前空間**
1. **基本ライブラリ**  
   - `System`, `System.IO` などの標準的な機能  
   - `System.Windows`, `System.Windows.Media.Media3D` でWPFや3Dレンダリングを利用  
   - `System.Windows.Threading` によりタイマーを実現  

2. **外部ライブラリ**  
   - `HelixToolkit.Wpf`: 3Dグラフや軸の描画に利用  
   - `Newtonsoft.Json`: JSONファイルの読み取りとデシリアライズに使用  

---

### **アプリケーションの構成**

#### 1. **フィールドとコンストラクタ**
- **フィールド**  
  - `DispatcherTimer timer`: グラフを定期的に更新するタイマー（今回はコメントアウトしている）。  
  - `Point3DCollection pointsCollection`: 描画する3Dポイントを保持するコレクション。  
  - `List<DataPoint> dataPoints`: JSONファイルから読み取ったデータポイントのリスト。  
  - `FileSystemWatcher fileWatcher`: 指定したJSONファイルの変更を監視。  

- **コンストラクタ**
  - 必要な初期化処理を実行：  
    1. 3Dポイントのコレクションやデータポイントの初期化  
    2. JSONファイルの変更を監視する設定を構築  
    3. 初期データを読み込む  
    4. X, Y, Z軸を描画する  

---

#### 2. **ファイル監視 (`SetupFileWatcher` と `OnFileChanged`)**
- **目的**: 指定されたディレクトリとファイル（例: `data.json`）の変更を検知。  
- **仕組み**:  
  - `FileSystemWatcher` を使い、ファイルが変更されたときにイベントを発生させる。  
  - **デバウンス機能**: `debounceTime`（500ミリ秒）を設定し、イベントの連続発生を防止。  
  - **動作**: ファイル変更時にデータを再読み込みし、グラフを更新。  

---

#### 3. **JSONデータの読み取り (`LoadData`)**
- **目的**: JSONファイルを読み込み、データを`DataPoint`オブジェクトのリストに変換。  
- **処理手順**:
  1. ファイルが存在しない場合はスキップ。  
  2. JSONデータをデシリアライズし、リストとして格納。  
  3. 必要なデータのみを反映。  

---

#### 4. **3Dグラフの更新 (`UpdateGraph`)**
- **目的**: 読み取ったデータを3Dグラフに追加描画。  
- **処理手順**:
  1. 一度に処理するデータ量を`chunkSize`（例: 1000）に制限。  
  2. `Point3D` オブジェクトを生成し、`pointsCollection` に追加。  
  3. まだ未処理のデータが残っている場合、非同期で次の処理をスケジュール。  

---

#### 5. **3D軸の追加 (`AddAxes`)**
- **目的**: X, Y, Z軸を視覚化。  
- **実装**:
  - `ArrowVisual3D` を使用して各軸を描画。  
  - `TextVisual3D` を用いて軸ラベル（例: "X (10m)"）を追加。  

---

#### 6. **`DataPoint`クラス**
- **概要**: JSONファイル内の1つのデータポイントを表現するクラス。  
  - プロパティ：`x`, `y`, `z`（文字列形式）。  
  - メソッド：`GetX`, `GetY`, `GetZ` で文字列を`double`に変換。  

---

### **動作の流れ**
1. **ファイル監視**: `data.json` の変更を検知。  
2. **データ読み取り**: JSONをデシリアライズし、データポイントをリストに格納。  
3. **3D描画**: データポイントを順次描画し、UIを更新。  
4. **軸表示**: X, Y, Z軸とラベルを描画。  

---

### **ポイント**
1. **リアルタイム更新**: JSONデータの変更を即座に反映し、グラフを更新。  
2. **エラーハンドリング**: ファイルが存在しない場合や不正なデータがある場合を考慮。  
3. **非同期処理**: UIスレッドのブロックを防ぎながらデータを効率的に処理。  

---
